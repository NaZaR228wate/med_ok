<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Оформлення замовлення — med_ok</title>
  <link rel="stylesheet" href="styles.css?v=6" />
</head>
<body>
<a class="visually-hidden" href="#main">Перейти до контенту</a>

<!-- Хедер як на index -->
<header>
  <div class="container nav">
    <a class="brand" href="index.html" aria-label="На головну">
      <svg viewBox="0 0 64 64" aria-hidden="true" focusable="false">
        <path fill="#f4b400" d="M22 10h20l10 12v20l-10 12H22L12 42V22z"/>
        <path fill="#fff" opacity=".6" d="M26 18h12l6 7v14l-6 7H26l-6-7V25z"/>
      </svg>
      <span>med_ok</span>
    </a>
    <nav id="primary-nav" data-open="true">
      <a href="index.html#products">Продукція</a>
      <a href="index.html#about">Про пасіку</a>
      <a href="index.html#why">Чому ми</a>
      <a class="cta" href="order.html">Замовити</a>
    </nav>
  </div>
</header>

<main id="main" class="container">
  <h1>Оформлення замовлення</h1>
  <p class="muted">Заповніть форму. Поля зі <b>*</b> — обов’язкові. Після натискання «Надіслати» відкриється поштовий клієнт із заповненим листом.</p>

  <section class="card" style="padding:18px" id="order">
    <form id="orderForm" novalidate>
      <!-- Ім'я / Телефон -->
      <div class="row row-1">
        <div class="col">
          <label for="name">Імʼя *</label>
          <input id="name" name="name" placeholder="Ваше імʼя" required />
        </div>
        <div class="col">
          <label for="phone">Телефон *</label>
          <input id="phone" name="phone" placeholder="+380..." inputmode="tel"
                 maxlength="13" pattern="^\+380\d{9}$" required
                 title="Формат: +380XXXXXXXXX" />
        </div>
      </div>

      <!-- Товар / Кількість -->
      <div class="row mt-16">
        <div class="col">
          <label for="honey">Вид меду *</label>
          <select id="honey" name="honey" required>
            <option value="Акація">Акація</option>
            <option value="Липовий">Липовий</option>
            <option value="Соняшниковий">Соняшниковий</option>
          </select>
        </div>
        <div class="col">
          <label for="qty">Кількість (л) *</label>
          <select id="qty" name="qty" required>
            <option value="0.5">0.5 л</option>
            <option value="1">1 л</option>
            <option value="2">2 л</option>
            <option value="3">3 л</option>
            <option value="5">5 л</option>
          </select>
        </div>
      </div>

      <!-- Доставка / Оплата -->
      <div class="row mt-16">
        <div class="col">
          <label for="ship">Спосіб доставки *</label>
          <select id="ship" name="ship" required>
            <option value="np_branch" selected>Нова пошта — відділення</option>
            <option value="np_courier">Нова пошта — курʼєр</option>
            <option value="pickup">Самовивіз</option>
          </select>
        </div>
        <div class="col">
          <label>Оплата *</label>
          <div style="display:flex;gap:16px;align-items:center;padding:10px 0">
            <label><input type="radio" name="pay" value="cod" checked> Накладений платіж</label>
            <label><input type="radio" name="pay" value="prepay"> Повна передоплата</label>
          </div>
        </div>
      </div>

      <!-- Простий ввід міста та відділення/адреси -->
      <div id="np-row" class="row mt-8">
        <div class="col">
          <label for="city">Місто / село *</label>
          <input id="city" name="city" placeholder="Напр.: Київ, Чубинське" minlength="2" required />
        </div>
        <div class="col">
          <label for="addr" id="addrLabel">Відділення (№/адреса) *</label>
          <input id="addr" name="addr" placeholder="№ відділення НП або адреса кур’єра" required />
          <div class="note mt-8" id="addrHint">Для курʼєра вкажіть точну адресу, для відділення — № та вулицю.</div>
        </div>
      </div>

      <!-- Коментар -->
      <div class="row mt-16">
        <div class="col" style="grid-column:1/-1">
          <label for="comment">Коментар</label>
          <textarea id="comment" name="comment" placeholder="Зручний час дзвінка, деталі замовлення тощо"></textarea>
        </div>
      </div>

      <div class="actions mt-16">
        <button type="submit" class="btn">Надіслати</button>
      </div>
      <p class="muted mt-16" style="text-align:center">
        Якщо обрано «повна передоплата», ми надішлемо реквізити після підтвердження.
      </p>
    </form>
  </section>

  <p class="mt-16"><a href="index.html">← На головну</a></p>
</main>

<script>
  // куди відправляти лист
  const ORDER_EMAIL = 'orders@example.com'; // ← заміни на свою пошту

  // DOM
  const form     = document.getElementById('orderForm');
  const nameI    = document.getElementById('name');
  const phoneI   = document.getElementById('phone');
  const honeySel = document.getElementById('honey');
  const qtySel   = document.getElementById('qty');
  const shipSel  = document.getElementById('ship');
  const cityI    = document.getElementById('city');
  const addrI    = document.getElementById('addr');
  const addrLbl  = document.getElementById('addrLabel');
  const addrHint = document.getElementById('addrHint');
  const commentI = document.getElementById('comment');

  // телефон — автододавання "+380" при фокусі, якщо порожньо
  phoneI.addEventListener('focus', () => {
    if (!phoneI.value.trim()) phoneI.value = '+380';
  });

  // Показ/тексти для поля адреси залежно від способу доставки
  function applyShipVisibility() {
    const v = shipSel.value;
    if (v === 'pickup') {
      // самовивіз — поля міста/адреси не потрібні
      cityI.closest('.col').style.display = 'none';
      addrI.closest('.col').style.display = 'none';
      cityI.required = false;
      addrI.required = false;
    } else {
      cityI.closest('.col').style.display = '';
      addrI.closest('.col').style.display = '';
      cityI.required = true;
      addrI.required = true;

      if (v === 'np_courier') {
        addrLbl.textContent = 'Адреса для курʼєра *';
        addrI.placeholder   = 'Місто/вулиця/будинок/квартира або точний орієнтир';
        addrHint.textContent = 'Курʼєр НП: вкажіть точну адресу для доставки.';
      } else {
        addrLbl.textContent = 'Відділення (№/адреса) *';
        addrI.placeholder   = 'Напр.: №1, вул. Поштова 10';
        addrHint.textContent = 'Відділення НП: номер і коротка адреса.';
      }
    }
  }
  shipSel.addEventListener('change', applyShipVisibility);

  // Підставити попередньо обраний вид меду з головної
  (function presetHoney() {
    const t = localStorage.getItem('preselected_type');
    if (!t) return;
    const map = { 'Акація':'Акація', 'Липовий':'Липовий', 'Соняшник':'Соняшниковий', 'Соняшниковий':'Соняшниковий' };
    const val = map[t] || t;
    for (const o of honeySel.options) { if (o.value === val) { honeySel.value = val; break; } }
    localStorage.removeItem('preselected_type');
  })();

  // Submit → відкриваємо e-mail клієнт з заповненим листом
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    if (!form.reportValidity()) return;

    const pay = form.querySelector('input[name="pay"]:checked')?.value || 'cod';
    const shipText = shipSel.options[shipSel.selectedIndex].text;

    const rows = [
      'Замовлення з сайту med_ok',
      `Імʼя: ${nameI.value}`,
      `Телефон: ${phoneI.value}`,
      `Вид меду: ${honeySel.value}`,
      `Кількість: ${qtySel.value} л`,
      `Доставка: ${shipText}`,
      (shipSel.value !== 'pickup') ? `Місто/село: ${cityI.value}` : null,
      (shipSel.value !== 'pickup') ? `${(shipSel.value==='np_courier'?'Адреса':'Відділення')}: ${addrI.value}` : null,
      `Оплата: ${pay === 'cod' ? 'Накладений платіж' : 'Повна передоплата'}`,
      commentI.value ? `Коментар: ${commentI.value}` : null
    ].filter(Boolean);

    const subject = encodeURIComponent('Замовлення меду — med_ok');
    const body    = encodeURIComponent(rows.join('\n'));
    window.location.href = `mailto:${ORDER_EMAIL}?subject=${subject}&body=${body}`;
  });

  // стартовий стан
  applyShipVisibility();
</script>
</body>
</html>
